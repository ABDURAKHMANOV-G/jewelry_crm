{% extends 'base.html' %}
{% load phone_filters %}

{% block title %}–ó–∞–∫–∞–∑—ã {{ customer.name }} {{ customer.surname }} - JEWEllUX{% endblock %}

{% block content %}
<section class="customer-orders-section">
    <div class="container-customer-orders">
        <!-- CUSTOMER INFO CARD -->
        <div class="customer-info-card">
            <div class="customer-info-main">
                <div class="customer-avatar">
                    <i class="bi bi-person"></i>
                </div>
                <div class="customer-details">
                    <h3 class="customer-detail-name">{{ customer.name }} {{ customer.surname }}</h3>
                    <div class="customer-contact-list">
                        <div class="customer-contact-item">
                            <i class="bi bi-telephone"></i>
                            {{ customer.phone|format_phone }}
                        </div>
                        <div class="customer-contact-item">
                            <i class="bi bi-envelope"></i>
                            {{ customer.email|default:"‚Äî" }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="customer-info-actions">
                <a href="{% url 'customer_list' %}" class="btn-back-to-list">
                    <i class="bi bi-arrow-left"></i>
                    –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </a>
            </div>
        </div>

        <!-- FILTERS CARD -->
        <div class="customer-filters-card">
            <div class="customer-filters-header">
                <h5 class="customer-filters-title">
                    <i class="bi bi-funnel"></i>
                    –§–∏–ª—å—Ç—Ä—ã
                </h5>
            </div>
            <div class="customer-filters-body">
                <form method="GET" class="customer-filters-form">
                    <div class="customer-filters-grid">
                        <div class="customer-filter-group">
                            <label class="customer-filter-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
                            <select name="status" class="customer-filter-select">
                                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="new" {% if status_filter == 'new' %}selected{% endif %}>–ù–æ–≤—ã–π</option>
                                <option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                                <option value="in_work" {% if status_filter == 'in_work' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
                                <option value="ready" {% if status_filter == 'ready' %}selected{% endif %}>–ì–æ—Ç–æ–≤</option>
                                <option value="delivered" {% if status_filter == 'delivered' %}selected{% endif %}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                            </select>
                        </div>
                        
                        <div class="customer-filter-group">
                            <label class="customer-filter-label">–¢–∏–ø –∑–∞–∫–∞–∑–∞</label>
                            <select name="order_type" class="customer-filter-select">
                                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="template" {% if order_type_filter == 'template' %}selected{% endif %}>–®–∞–±–ª–æ–Ω–Ω—ã–π</option>
                                <option value="custom" {% if order_type_filter == 'custom' %}selected{% endif %}>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π</option>
                            </select>
                        </div>
                        
                        <div class="customer-filter-group">
                            <label class="customer-filter-label">–¢–∏–ø –∏–∑–¥–µ–ª–∏—è</label>
                            <select name="product_type" class="customer-filter-select">
                                <option value="">–í—Å–µ –∏–∑–¥–µ–ª–∏—è</option>
                                <option value="ring" {% if product_type_filter == 'ring' %}selected{% endif %}>–ö–æ–ª—å—Ü–æ</option>
                                <option value="brooch" {% if product_type_filter == 'brooch' %}selected{% endif %}>–ë—Ä–æ—à—å</option>
                                <option value="bracelet" {% if product_type_filter == 'bracelet' %}selected{% endif %}>–ë—Ä–∞—Å–ª–µ—Ç</option>
                                <option value="earrings" {% if product_type_filter == 'earrings' %}selected{% endif %}>–°–µ—Ä—å–≥–∏</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="customer-filters-actions">
                        <button type="submit" class="btn-filter-apply">
                            <i class="bi bi-check-lg"></i>
                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                        <a href="{% url 'customer_orders' customer.customer_id %}" class="btn-filter-reset">
                            <i class="bi bi-x-lg"></i>
                            –°–±—Ä–æ—Å–∏—Ç—å
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- ORDERS SECTION -->
        <div class="customer-orders-header">
            <h4 class="customer-orders-title">
                <i class="bi bi-file-earmark-text"></i>
                –ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–∞
            </h4>
            <span class="customer-orders-count">{{ orders|length }}</span>
        </div>

        {% if orders %}
        <div class="customer-orders-table-wrapper">
            <table class="customer-orders-table">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–¢–∏–ø –∏–∑–¥–µ–ª–∏—è</th>
                        <th>–¢–∏–ø –∑–∞–∫–∞–∑–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ë—é–¥–∂–µ—Ç</th>
                        <th>–°–æ–∑–¥–∞–Ω</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>
                            <span class="order-number-cell">#{{ order.order_id }}</span>
                        </td>
                        <td>
                            <span class="product-type-cell">
                                {% if order.product_type == 'ring' %}üíç –ö–æ–ª—å—Ü–æ
                                {% elif order.product_type == 'brooch' %}üå∏ –ë—Ä–æ—à—å
                                {% elif order.product_type == 'bracelet' %}üìø –ë—Ä–∞—Å–ª–µ—Ç
                                {% elif order.product_type == 'earrings' %}üíé –°–µ—Ä—å–≥–∏
                                {% else %}‚Äî{% endif %}
                            </span>
                        </td>
                        <td class="order-type-cell">
                            {% if order.order_type == 'template' %}
                            <span class="order-type-badge-template">
                                <i class="bi bi-file-earmark"></i>
                                –®–∞–±–ª–æ–Ω–Ω—ã–π
                            </span>
                            {% elif order.order_type == 'custom' %}
                            <span class="order-type-badge-custom">
                                <i class="bi bi-pencil"></i>
                                –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π
                            </span>
                            {% else %}‚Äî{% endif %}
                        </td>
                        <td>
                            {% if order.order_status == 'new' %}
                            <span class="status-badge-new">{{ order.get_status_display_ru }}</span>
                            {% elif order.order_status == 'confirmed' %}
                            <span class="status-badge-confirmed">{{ order.get_status_display_ru }}</span>
                            {% elif order.order_status == 'in_work' %}
                            <span class="status-badge-in-work">{{ order.get_status_display_ru }}</span>
                            {% elif order.order_status == 'ready' %}
                            <span class="status-badge-ready">{{ order.get_status_display_ru }}</span>
                            {% elif order.order_status == 'delivered' %}
                            <span class="status-badge-delivered">{{ order.get_status_display_ru }}</span>
                            {% else %}‚Äî{% endif %}
                        </td>
                        <td>
                            <span class="budget-cell">{{ order.budget|default:"‚Äî" }} ‚ÇΩ</span>
                        </td>
                        <td>
                            <span class="date-cell">{{ order.created_at|date:"d.m.Y" }}</span>
                        </td>
                        <td>
                            <a href="{% url 'order_detail' order.order_id %}" class="btn-open-order">
                                <i class="bi bi-eye"></i>
                                –û—Ç–∫—Ä—ã—Ç—å
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-customer-orders">
            <i class="bi bi-inbox"></i>
            <h4>–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p>–£ —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
