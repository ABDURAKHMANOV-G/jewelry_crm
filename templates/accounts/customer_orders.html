{% extends 'base.html' %}
{% load phone_filters %}

{% block title %}–ó–∞–∫–∞–∑—ã {{ customer.name }} {{ customer.surname }}{% endblock %}

{% block content %}
<!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ö–õ–ò–ï–ù–¢–ï -->
<div class="card mb-4 shadow">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h3 class="mb-2">üë§ {{ customer.name }} {{ customer.surname }}</h3>
                <p class="mb-1">
                    <i class="bi bi-telephone"></i> {{ customer.phone|format_phone }}
                </p>
                <p class="mb-0">
                    <i class="bi bi-envelope"></i> {{ customer.email|default:"‚Äî" }}
                </p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'customer_list' %}" class="btn btn-secondary">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫–ª–∏–µ–Ω—Ç–æ–≤
                </a>
            </div>
        </div>
    </div>
</div>

<!-- –§–ò–õ–¨–¢–†–´ -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">üîç –§–∏–ª—å—Ç—Ä—ã</h5>
    </div>
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
                <select name="status" class="form-control">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="new" {% if status_filter == 'new' %}selected{% endif %}>–ù–æ–≤—ã–π</option>
                    <option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                    <option value="in_work" {% if status_filter == 'in_work' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
                    <option value="ready" {% if status_filter == 'ready' %}selected{% endif %}>–ì–æ—Ç–æ–≤</option>
                    <option value="delivered" {% if status_filter == 'delivered' %}selected{% endif %}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                </select>
            </div>
            
            <div class="col-md-4">
                <label class="form-label">–¢–∏–ø –∑–∞–∫–∞–∑–∞</label>
                <select name="order_type" class="form-control">
                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                    <option value="template" {% if order_type_filter == 'template' %}selected{% endif %}>–®–∞–±–ª–æ–Ω–Ω—ã–π</option>
                    <option value="custom" {% if order_type_filter == 'custom' %}selected{% endif %}>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π</option>
                </select>
            </div>
            
            <div class="col-md-4">
                <label class="form-label">–¢–∏–ø –∏–∑–¥–µ–ª–∏—è</label>
                <select name="product_type" class="form-control">
                    <option value="">–í—Å–µ –∏–∑–¥–µ–ª–∏—è</option>
                    <option value="ring" {% if product_type_filter == 'ring' %}selected{% endif %}>–ö–æ–ª—å—Ü–æ</option>
                    <option value="brooch" {% if product_type_filter == 'brooch' %}selected{% endif %}>–ë—Ä–æ—à—å</option>
                    <option value="bracelet" {% if product_type_filter == 'bracelet' %}selected{% endif %}>–ë—Ä–∞—Å–ª–µ—Ç</option>
                    <option value="earrings" {% if product_type_filter == 'earrings' %}selected{% endif %}>–°–µ—Ä—å–≥–∏</option>
                </select>
            </div>
            
            <div class="col-12">
                <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                <a href="{% url 'customer_orders' customer.customer_id %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </form>
    </div>
</div>

<!-- –°–ü–ò–°–û–ö –ó–ê–ö–ê–ó–û–í -->
<h4 class="mb-3">üìã –ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–∞ ({{ orders|length }})</h4>

{% if orders %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-dark">
            <tr>
                <th>‚Ññ</th>
                <th>–¢–∏–ø –∏–∑–¥–µ–ª–∏—è</th>
                <th>–¢–∏–ø –∑–∞–∫–∞–∑–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ë—é–¥–∂–µ—Ç</th>
                <th>–°–æ–∑–¥–∞–Ω</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td><strong>#{{ order.order_id }}</strong></td>
                <td>
                    {% if order.product_type == 'ring' %}üíç –ö–æ–ª—å—Ü–æ
                    {% elif order.product_type == 'brooch' %}üå∏ –ë—Ä–æ—à—å
                    {% elif order.product_type == 'bracelet' %}üìø –ë—Ä–∞—Å–ª–µ—Ç
                    {% elif order.product_type == 'earrings' %}üíé –°–µ—Ä—å–≥–∏
                    {% else %}‚Äî{% endif %}
                </td>
                <td>
                    {% if order.order_type == 'template' %}üìã –®–∞–±–ª–æ–Ω–Ω—ã–π
                    {% elif order.order_type == 'custom' %}‚úèÔ∏è –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π
                    {% else %}‚Äî{% endif %}
                </td>
                <td>
                    <span class="badge 
                        {% if order.order_status == 'new' %}bg-primary
                        {% elif order.order_status == 'confirmed' %}bg-info
                        {% elif order.order_status == 'in_work' %}bg-warning
                        {% elif order.order_status == 'ready' %}bg-success
                        {% elif order.order_status == 'delivered' %}bg-secondary
                        {% endif %}
                    ">
                        {{ order.get_status_display_ru }}
                    </span>
                </td>
                <td>{{ order.budget|default:"‚Äî" }} ‚ÇΩ</td>
                <td>{{ order.created_at|date:"d.m.Y" }}</td>
                <td>
                    <a href="{% url 'order_detail' order.order_id %}" class="btn btn-sm btn-primary">
                        –û—Ç–∫—Ä—ã—Ç—å
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info text-center">
    <h4>–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
    <p>–£ —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</p>
</div>
{% endif %}
{% endblock %}
