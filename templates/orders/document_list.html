{% extends 'base.html' %}

{% block title %}–î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–∞ #{{ order.order_id }}{% endblock %}

{% block content %}
<!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ó–ê–ö–ê–ó–ï -->
<div class="card mb-4 shadow">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h3 class="mb-2">üìã –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–∞ #{{ order.order_id }}</h3>
                <p class="mb-1">
                    <strong>–ö–ª–∏–µ–Ω—Ç:</strong> {{ order.customer.name }} {{ order.customer.surname }}
                </p>
                <p class="mb-0">
                    <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                    <span class="badge 
                        {% if order.order_status == 'new' %}bg-primary
                        {% elif order.order_status == 'confirmed' %}bg-info
                        {% elif order.order_status == 'in_work' %}bg-warning
                        {% elif order.order_status == 'ready' %}bg-success
                        {% elif order.order_status == 'delivered' %}bg-secondary
                        {% endif %}
                    ">
                        {{ order.get_status_display_ru }}
                    </span>
                </p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'order_detail' order.order_id %}" class="btn btn-secondary mb-2">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑—É
                </a>
                {% if user.role == 'manager' %}
                <a href="{% url 'document_create' order.order_id %}" class="btn btn-primary mb-2">
                    <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –°–ü–ò–°–û–ö –î–û–ö–£–ú–ï–ù–¢–û–í -->
<h4 class="mb-3">üìÑ –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ({{ documents|length }})</h4>

{% if documents %}
<div class="row">
    {% for document in documents %}
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="card-title mb-0">
                        {{ document.get_document_type_display_icon }} {{ document.get_document_type_display }}
                    </h5>
                    <span class="badge bg-secondary">‚Ññ{{ document.document_number }}</span>
                </div>
                
                <p class="mb-2">
                    <strong>–î–∞—Ç–∞:</strong> {{ document.document_date|date:"d.m.Y" }}
                </p>
                
                {% if document.amount %}
                <p class="mb-2">
                    <strong>–°—É–º–º–∞:</strong> <span class="text-success fs-5">{{ document.amount }} ‚ÇΩ</span>
                </p>
                {% endif %}
                
                {% if document.description %}
                <p class="mb-2 text-muted">
                    {{ document.description|truncatewords:20 }}
                </p>
                {% endif %}
                
                <p class="mb-3 small text-muted">
                    <strong>–°–æ–∑–¥–∞–Ω:</strong> {{ document.uploaded_at|date:"d.m.Y H:i" }}
                    {% if document.created_by %}
                    <br><strong>–ê–≤—Ç–æ—Ä:</strong> {{ document.created_by.get_full_name|default:document.created_by.username }}
                    {% endif %}
                </p>
                
                <div class="d-flex gap-2">
                    <!-- –ö–Ω–æ–ø–∫–∞ PDF –¥–ª—è –í–°–ï–• -->
                    <a href="{% url 'document_export_pdf' document.document_id %}" class="btn btn-sm btn-success">
                        <i class="bi bi-download"></i> PDF
                    </a>
                    
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ -->
                    {% if user.role == 'manager' %}
                    <a href="{% url 'document_update' document.document_id %}" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'document_delete' document.document_id %}" 
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?')">
                        <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info text-center">
    <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
    <p>–ö —ç—Ç–æ–º—É –∑–∞–∫–∞–∑—É –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞</p>
    {% if user.role == 'manager' %}
    <a href="{% url 'document_create' order.order_id %}" class="btn btn-primary">
        –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
