{% extends 'base.html' %}

{% block title %}–î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–∞ #{{ order.order_id }} - JEWEllUX{% endblock %}

{% block content %}
<section class="documents-section">
    <div class="container-documents">
        
        <!-- HEADER -->
        <div class="documents-header">
            <div class="header-left">
                <a href="{% url 'order_detail' order.order_id %}" class="btn-back">
                    <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑—É
                </a>
                <h1 class="documents-title">
                    <i class="bi bi-file-earmark-text"></i>
                    –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–∞ #{{ order.order_id }}
                </h1>
            </div>
            
            {% if user.role == 'manager' %}
            <div class="header-actions">
                <a href="{% url 'document_create' order.order_id %}" class="btn-gold">
                    <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                </a>
            </div>
            {% endif %}
        </div>

        <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ó–ê–ö–ê–ó–ï (–º–∏–Ω–∏-–∫–∞—Ä—Ç–æ—á–∫–∞) -->
        <div class="order-info-mini">
            <div class="info-mini-item">
                <i class="bi bi-person"></i>
                <span><strong>–ö–ª–∏–µ–Ω—Ç:</strong> {{ order.customer.name }} {{ order.customer.surname }}</span>
            </div>
            <div class="info-mini-item">
                <i class="bi bi-diagram-3"></i>
                <span>
                    <strong>–°—Ç–∞—Ç—É—Å:</strong>
                    <span class="status-badge status-{{ order.order_status }}">
                        {{ order.get_status_display_ru }}
                    </span>
                </span>
            </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –î–û–ö–£–ú–ï–ù–¢–û–í -->
        {% if documents %}
        <div class="documents-grid">
            {% for document in documents %}
            <div class="document-card">
                <div class="document-header">
                    <div class="document-type-icon">
                        {% if document.document_type == 'contract' %}
                            <i class="bi bi-file-earmark-text"></i>
                        {% elif document.document_type == 'invoice' %}
                            <i class="bi bi-receipt"></i>
                        {% elif document.document_type == 'sketch' %}
                            <i class="bi bi-image"></i>
                        {% elif document.document_type == 'certificate' %}
                            <i class="bi bi-award"></i>
                        {% else %}
                            <i class="bi bi-file"></i>
                        {% endif %}
                    </div>
                    
                    <div class="document-info">
                        <h3 class="document-title">
                            {% if document.document_type == 'contract' %}üìÑ –î–æ–≥–æ–≤–æ—Ä
                            {% elif document.document_type == 'invoice' %}üßæ –°—á–µ—Ç
                            {% elif document.document_type == 'sketch' %}üé® –≠—Å–∫–∏–∑
                            {% elif document.document_type == 'certificate' %}üèÜ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                            {% else %}üìé –î–æ–∫—É–º–µ–Ω—Ç{% endif %}
                        </h3>
                        
                        {% if document.document_date %}
                        <p class="document-date">
                            <i class="bi bi-calendar3"></i>
                            {{ document.document_date|date:"d.m.Y" }}
                        </p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="document-body">
                    {% if document.amount %}
                    <div class="document-amount">
                        <span class="amount-label">–°—É–º–º–∞:</span>
                        <span class="amount-value">{{ document.amount }} ‚ÇΩ</span>
                    </div>
                    {% endif %}
                    
                    {% if document.description %}
                    <p class="document-description">{{ document.description|truncatewords:20 }}</p>
                    {% endif %}
                </div>
                
                <div class="document-footer">
                    <div class="document-meta">
                        <span class="meta-item">
                            <i class="bi bi-clock"></i>
                            {{ document.uploaded_at|date:"d.m.Y H:i" }}
                        </span>
                        
                        {% if document.created_by %}
                        <span class="meta-item">
                            <i class="bi bi-person-circle"></i>
                            {{ document.created_by.get_full_name|default:document.created_by.username }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="document-actions">
                        <a href="{% url 'document_export_pdf' document.pk %}" 
                           class="btn-doc-action btn-view"
                           title="–°–∫–∞—á–∞—Ç—å PDF">
                            <i class="bi bi-download"></i>
                        </a>
                        
                        {% if user.role == 'manager' %}
                        <a href="{% url 'document_update' document.pk %}" 
                           class="btn-doc-action btn-edit"
                           title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="bi bi-pencil"></i>
                        </a>
                        
                        <a href="{% url 'document_delete' document.pk %}" 
                           class="btn-doc-action btn-delete"
                           title="–£–¥–∞–ª–∏—Ç—å"
                           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?')">
                            <i class="bi bi-trash"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <p class="documents-count">–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {{ documents|length }}</p>
        
        {% else %}
        <!-- –ü–£–°–¢–û–ï –°–û–°–¢–û–Ø–ù–ò–ï -->
        <div class="no-documents">
            <i class="bi bi-folder2-open"></i>
            <h3>–ö —ç—Ç–æ–º—É –∑–∞–∫–∞–∑—É –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
            {% if user.role == 'manager' %}
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–∫–∞–∑–∞</p>
            <a href="{% url 'document_create' order.order_id %}" class="btn-gold btn-lg">
                <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
            </a>
            {% endif %}
        </div>
        {% endif %}

    </div>
</section>
{% endblock %}
