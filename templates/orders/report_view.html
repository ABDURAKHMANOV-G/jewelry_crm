{% extends 'base.html' %}

{% block title %}–û—Ç—á—ë—Ç {{ start_date|date:"d.m.Y" }} - {{ end_date|date:"d.m.Y" }} - JEWEllUX{% endblock %}

{% block content %}
<section class="report-view-section">
    <div class="report-view-container">
        <!-- HEADER CARD -->
        <div class="report-header-card">
            <div class="report-header-info">
                <h1 class="report-header-title">
                    <i class="bi bi-file-earmark-bar-graph"></i>
                    –û—Ç—á—ë—Ç –æ —Ä–∞–±–æ—Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏
                </h1>
                <div class="report-header-meta">
                    <div class="report-meta-item">
                        <span class="report-meta-label">–ü–µ—Ä–∏–æ–¥:</span>
                        <span class="report-meta-value">{{ start_date|date:"d.m.Y" }} - {{ end_date|date:"d.m.Y" }}</span>
                    </div>
                    <div class="report-meta-item">
                        <span class="report-meta-label">–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è:</span>
                        <span class="report-meta-value">{{ now|date:"d.m.Y H:i" }}</span>
                    </div>
                </div>
            </div>
            <div class="report-header-actions">
                <a href="{% url 'report_form' %}" class="btn-report-back">
                    <i class="bi bi-arrow-left"></i>
                    –ù–∞–∑–∞–¥
                </a>
                <a href="{% url 'report_export_pdf' %}?start_date={{ start_date|date:'Y-m-d' }}&end_date={{ end_date|date:'Y-m-d' }}" 
                   class="btn-report-download">
                    <i class="bi bi-download"></i>
                    –°–∫–∞—á–∞—Ç—å PDF
                </a>
            </div>
        </div>

        <!-- STATS GRID -->
        <div class="report-stats-grid">
            <div class="report-stat-card">
                <div class="report-stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                <h2 class="report-stat-value stat-primary">{{ report_data.total_orders }}</h2>
            </div>
            
            <div class="report-stat-card">
                <div class="report-stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                <h2 class="report-stat-value stat-success">{{ report_data.total_revenue|floatformat:0 }} ‚ÇΩ</h2>
            </div>
            
            <div class="report-stat-card">
                <div class="report-stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                <h2 class="report-stat-value stat-info">{{ report_data.avg_order_value|floatformat:0 }} ‚ÇΩ</h2>
            </div>
            
            <div class="report-stat-card">
                <div class="report-stat-label">–î–Ω–µ–π –≤ –ø–µ—Ä–∏–æ–¥–µ</div>
                <h2 class="report-stat-value stat-warning">{% widthratio period_days 1 1 %}</h2>
            </div>
        </div>

        <!-- TWO COLUMN LAYOUT -->
        <div class="report-two-columns">
            <!-- STATUS STATS -->
            <div class="report-data-card">
                <div class="report-data-header">
                    <h3 class="report-data-title">
                        <i class="bi bi-list-check"></i>
                        –ó–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
                    </h3>
                </div>
                <div class="report-data-body">
                    <table class="report-simple-table">
                        <tbody>
                            {% for item in report_data.status_stats %}
                            <tr>
                                <td>
                                    {% if item.order_status == 'new' %}üÜï –ù–æ–≤—ã–π
                                    {% elif item.order_status == 'confirmed' %}‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
                                    {% elif item.order_status == 'in_work' %}‚öôÔ∏è –í —Ä–∞–±–æ—Ç–µ
                                    {% elif item.order_status == 'ready' %}‚úîÔ∏è –ì–æ—Ç–æ–≤
                                    {% elif item.order_status == 'delivered' %}üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω
                                    {% endif %}
                                </td>
                                <td>{{ item.count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- PRODUCT STATS -->
            <div class="report-data-card">
                <div class="report-data-header">
                    <h3 class="report-data-title">
                        <i class="bi bi-gem"></i>
                        –¢–∏–ø—ã –∏–∑–¥–µ–ª–∏–π
                    </h3>
                </div>
                <div class="report-data-body">
                    <table class="report-simple-table">
                        <tbody>
                            {% for item in report_data.product_stats %}
                            <tr>
                                <td>
                                    {% if item.product_type == 'ring' %}üíç –ö–æ–ª—å—Ü–∞
                                    {% elif item.product_type == 'brooch' %}üå∏ –ë—Ä–æ—à–∏
                                    {% elif item.product_type == 'bracelet' %}üìø –ë—Ä–∞—Å–ª–µ—Ç—ã
                                    {% elif item.product_type == 'earrings' %}üíé –°–µ—Ä—å–≥–∏
                                    {% else %}‚ùì –ù–µ —É–∫–∞–∑–∞–Ω–æ
                                    {% endif %}
                                </td>
                                <td>{{ item.count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TOP CUSTOMERS -->
        <div class="report-full-card">
            <div class="report-data-header">
                <h3 class="report-data-title">
                    <i class="bi bi-star"></i>
                    –¢–û–ü-5 –ö–ª–∏–µ–Ω—Ç–æ–≤
                </h3>
            </div>
            <div class="report-data-body">
                <table class="report-detailed-table">
                    <thead>
                        <tr>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th class="text-center">–ó–∞–∫–∞–∑–æ–≤</th>
                            <th class="text-end">–°—É–º–º–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for customer in report_data.top_customers %}
                        <tr>
                            <td>{{ customer.customer__name }} {{ customer.customer__surname }}</td>
                            <td class="text-center">
                                <span class="report-customer-badge">{{ customer.count }}</span>
                            </td>
                            <td class="text-end">
                                <span class="report-amount">{{ customer.total_spent|default:0|floatformat:2 }} ‚ÇΩ</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ALL ORDERS -->
        <div class="report-full-card">
            <div class="report-data-header">
                <h3 class="report-data-title">
                    <i class="bi bi-list-ul"></i>
                    –í—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞ –ø–µ—Ä–∏–æ–¥ ({{ orders.count }})
                </h3>
            </div>
            <div class="report-data-body">
                <table class="report-detailed-table">
                    <thead>
                        <tr>
                            <th>‚Ññ –ó–∞–∫–∞–∑–∞</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–¢–∏–ø</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th class="text-end">–°—É–º–º–∞</th>
                            <th>–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td>
                                <span class="report-order-number">#{{ order.order_id }}</span>
                            </td>
                            <td>{{ order.customer.name }} {{ order.customer.surname }}</td>
                            <td>
                                {% if order.product_type == 'ring' %}üíç –ö–æ–ª—å—Ü–æ
                                {% elif order.product_type == 'brooch' %}üå∏ –ë—Ä–æ—à—å
                                {% elif order.product_type == 'bracelet' %}üìø –ë—Ä–∞—Å–ª–µ—Ç
                                {% elif order.product_type == 'earrings' %}üíé –°–µ—Ä—å–≥–∏
                                {% else %}‚Äî
                                {% endif %}
                            </td>
                            <td>
                                <span class="report-status-badge status-{{ order.order_status }}">
                                    {{ order.get_status_display_ru }}
                                </span>
                            </td>
                            <td class="text-end">
                                <span class="report-amount">{{ order.budget|default:"‚Äî" }} ‚ÇΩ</span>
                            </td>
                            <td>
                                <span class="report-date">{{ order.created_at|date:"d.m.Y" }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
{% endblock %}
